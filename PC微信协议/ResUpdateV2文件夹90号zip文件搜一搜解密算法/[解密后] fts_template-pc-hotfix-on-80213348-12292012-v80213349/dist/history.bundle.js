"use strict";(self.webpackChunkweixin_search=self.webpackChunkweixin_search||[]).push([["history"],{20533:function(t,e,i){var n=i(602772),o=i(961945),r=i(551900),s=i(276877),a=(0,r.Z)(o.Z,n.s,n.x,!1,null,"cb21e9a6",null);"function"==typeof s.Z&&(0,s.Z)(a),e.Z=a.exports},805468:function(t,e,i){i.d(e,{Z:function(){return n}});function n(t){t.options.__wxs_id="54d42362"}},770952:function(t,e,i){var n=i(583432),o=i(774033),r=i(551900),s=i(389049),a=(0,r.Z)(o.Z,n.s,n.x,!1,null,"701d9fe0",null);"function"==typeof s.Z&&(0,s.Z)(a),e.Z=a.exports},591006:function(t,e,i){i.d(e,{Z:function(){return n}});function n(t){t.options.__wxs_id="6a444daf"}},245017:function(t,e,i){var n=i(983437),o=i(366270),r=i(551900),s=i(221260),a=(0,r.Z)(o.Z,n.s,n.x,!1,null,"246a6d21",null);"function"==typeof s.Z&&(0,s.Z)(a),e.Z=a.exports},442626:function(t,e,i){i.d(e,{Z:function(){return n}});function n(t){t.options.__wxs_id="9fe60bbe"}},640273:function(t,e,i){i.r(e);var n=i(6617),o=i(748519),r=i(551900),s=i(839040),a=(0,r.Z)(o.Z,n.s,n.x,!1,null,null,null);"function"==typeof s.Z&&(0,s.Z)(a),e.default=a.exports},90408:function(t,e,i){i.d(e,{Z:function(){return n}});function n(t){t.options.__wxs_id="4ce734bb"}},276877:function(t,e,i){var n=i(805468);e.Z=n.Z},389049:function(t,e,i){var n=i(591006);e.Z=n.Z},221260:function(t,e,i){var n=i(442626);e.Z=n.Z},839040:function(t,e,i){var n=i(90408);e.Z=n.Z},961945:function(t,e,i){var n=i(374470);e.Z=n.Z},774033:function(t,e,i){var n=i(3754);e.Z=n.Z},366270:function(t,e,i){var n=i(637741);e.Z=n.Z},748519:function(t,e,i){var n=i(115351);e.Z=n.Z},602772:function(t,e,i){i.d(e,{s:function(){return n},x:function(){return o}});var n=function(){var t=this.$createElement,e=this._self._c||t;return e(this.wrapper,{directives:[{name:"active",rawName:"v-active.instant",modifiers:{instant:!0}}],tag:"component",staticClass:"weui-cell history-action active__item",attrs:{role:"button","aria-label":this.title,"data-fc-17ce68d53":"","data-cli":"","data-fcn-history-clear-item":"","data-fr-16f62469e":""}},[this.hideClearIcon?this._e():e("svg-icon",{staticClass:"history-action__icon",attrs:{name:"trashcan","aria-hidden":"true","data-fc-17ce68d54":""}}),this._v("\n    "+this._s(this.title)+"\n    "),this._t("default")],2)},o=[]},583432:function(t,e,i){i.d(e,{s:function(){return n},x:function(){return o}});var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"active",rawName:"v-active.instant",value:t.enableHoverActive,expression:"enableHoverActive",modifiers:{instant:!0}}],staticClass:"weui-cell history-item active__item",class:{"is-hide-logo-teach":t.isHideLogo},attrs:{"data-cli":"","data-fcn-history-item":"","data-fr-1e5e4b544":""},on:{click:function(e){return e.stopPropagation(),t.$emit("tap",e)}}},[t.hasClock?i("div",{staticClass:"weui-cell__hd",attrs:{"aria-hidden":"true"}},[i("svg-icon",{staticClass:"history__icon",attrs:{name:"clock","data-fc-114a70693":""}})],1):t._e(),i("div",{staticClass:"weui-cell__bd",attrs:{role:"button"}},[i("div",{staticClass:"history__title"},[i("span",{staticClass:"ellipsis_1",attrs:{"aria-label":t.title}},[t._v(t._s(t.title))]),t.tags.length?i("ui-tags",{staticClass:"history__tags",attrs:{tags:t.tags,flex:"","data-fc-114a70694":""}}):t._e(),t.postfixIcon?i("ui-image",{staticClass:"history__postfix-icon",attrs:{size:18,url:t.postfixIcon,"data-fc-114a70695":""}}):t._e()],1),t.desc?i("div",{staticClass:"history__desc"},[t._v(t._s(t.desc))]):t._e()]),t.hasArrow||t.hasDelete?i("div",{staticClass:"weui-cell__ft",class:{"always-show":t.alwaysShowDelete}},[t.hasArrow?i("div",{directives:[{name:"active",rawName:"v-active.stop",value:t.enableHoverActive,expression:"enableHoverActive",modifiers:{stop:!0}}],staticClass:"active__opacity",attrs:{role:"button","aria-label":"添加到搜索栏","data-cli":""},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.$emit("tap:arrow",e)}}},[i("svg-icon",{staticClass:"history__icon",attrs:{name:"arrow.up.left","data-fc-114a70696":""}})],1):t._e(),t.hasDelete&&t.os.pc?i("div",t._b({directives:[{name:"active",rawName:"v-active.instant",value:t.enableHoverActive,expression:"enableHoverActive",modifiers:{instant:!0}}],staticClass:"active__item",class:{active:t.deleteActive},attrs:{role:"button","aria-label":"删除","data-cli":""},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.$emit("tap:delete",e)},mouseover:function(e){return t.$emit("over:delete")}}},"div",t.deleteIconProps,!1),[i("svg-icon",{staticClass:"history__icon",attrs:{name:"cross","data-fc-114a70697":""}})],1):t.hasDelete?i("div",t._b({directives:[{name:"active",rawName:"v-active.stop",modifiers:{stop:!0}}],key:t.title,staticClass:"active__item",class:{active:t.deleteActive},attrs:{role:"button","aria-label":"删除","data-cli":""},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.$emit("tap:delete",e)}}},"div",t.deleteIconProps,!1),[i("svg-icon",{staticClass:"history__icon",attrs:{name:"cross","data-fc-114a70698":""}})],1):t._e()]):t._e()])},o=[]},983437:function(t,e,i){i.d(e,{s:function(){return n},x:function(){return o}});var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i(t.wrapper,{tag:"component",staticClass:"weui-cell history-action",attrs:{"data-fc-1f2e11c6a":"","data-fcn-history-pc-bottom-item":"","data-fr-1396219b4":""}},[t.showExpand?i("div",{directives:[{name:"active",rawName:"v-active.instant",modifiers:{instant:!0}}],staticClass:"history-action__left active__mask",class:{active:t.isExpandBtnActive},attrs:{role:"button","aria-label":t.leftBtnTitle,"data-cli":""},on:{click:function(e){return t.$emit("tap:expand",!t.isExpand)},mouseover:t.onMoveOverExpand}},[t._v("\n      "+t._s(t.leftBtnTitle)+"\n    ")]):i("div"),i("div",{directives:[{name:"active",rawName:"v-active.instant",modifiers:{instant:!0}}],staticClass:"history-action__right active__mask",class:{active:t.isClearBtnActive},attrs:{role:"button","aria-label":t.rightBtnTitle,"data-cli":""},on:{click:function(e){return t.$emit("tap:clear")},mouseover:t.onMoveOverClear}},[t._v("\n      "+t._s(t.rightBtnTitle)+"\n    ")])])},o=[]},6617:function(t,e,i){i.d(e,{s:function(){return n},x:function(){return o}});var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("scroll",{attrs:{expose:t.expose,"expose-option":{isBindScrollAtContainer:t.os.pc},"data-fc-1a02ced1e":"","data-fcn-history":"","data-fr-157bf6280":""}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.os.pc&&t.historyListShow.length||t.os.mobile,expression:"os.pc && historyListShow.length || os.mobile"}],staticClass:"history-page",on:{touchmove:t.handleTouchmove}},[i("div",[i("div",{staticClass:"ui-aria-hidden"},[t._v("历史记录")]),i("exposure-block",{ref:"exposureBlock",attrs:{attr:"data-new-teach-report-id","expose-option":{ensureWithinContainer:!0},"data-fc-1a02ced1c":""},on:{expose:t.exposeReportFor26897}},[i("div",{ref:"historyScroll",style:t.historyListStyle,on:{scroll:t.onScroll}},t._l(t.historyListShow,function(e,n){return i("history-item",{key:n,ref:"historyItem",refInFor:!0,class:{active:n===t.selectIndex},attrs:{title:e.hotword,desc:e.jumpUrl,"postfix-icon":t.getIconUrl(e),"enable-hover-active":t.enableHoverActive,"has-arrow":t.hasArrow,"data-expose-id":n+"$$"+e.id+"$$"+e.hotword,"delete-active":t.isDeleteActive(n),"always-show-delete":t.os.pc,"data-new-teach-report-id":""+t.M_getItemReportId(t.getReportItem(e),t.getRealIndex(e,n)+1,t.getBlockCtx()),"data-fc-1a02ced1a":""},on:{tap:function(i){return t.tapItem(e,n)},"tap:delete":function(i){return t.tapDelete(e,n)},"tap:arrow":function(i){return t.tapArrow(e,n)},"over:delete":function(e){return t.overDelete(n)}},nativeOn:{mouseenter:function(e){return t.$emit("hover",n)}}})}),1)]),t.os.pc&&t.showPcBottom?i("pc-history-bottom-item",{ref:"bottomRef",attrs:{wrapper:"label","is-expand":t.isHistoryExpand,"show-expand":t.showPcBottomExpand,"select-info":t.selectInfo,for:t.SearchInputId,"data-fc-1a02ced18":""},on:{"tap:expand":t.onTapExpand,"tap:clear":t.tapDeleteAll,hover:t.emitHover}}):!t.os.pc&&t.showDelete?i("history-clear-item",{attrs:{wrapper:"label",for:t.SearchInputId,"data-fc-1a02ced16":""},nativeOn:{click:function(e){return t.tapDeleteAll(e)}}}):t._e()],1)])])},o=[]},374470:function(t,e,i){var n=i(798509);e.Z={name:"HistoryClearItem",props:{wrapper:{type:String,default:"div"},title:{type:String,default:n.Zr.L("清除历史")},hideClearIcon:{type:Boolean,default:!1}}}},3754:function(t,e,i){var n=i(798509);e.Z={props:{title:{type:String,default:""},tags:{type:Array,default:function(){return[]}},desc:{type:String,default:""},postfixIcon:{type:String,default:""},hasClock:{type:Boolean,default:!0},hasArrow:{type:Boolean,default:!1},hasDelete:{type:Boolean,default:!0},alwaysShowDelete:{type:Boolean},deleteIconProps:{type:Object,default:function(){return{}}},deleteActive:{type:Boolean,default:!1},enableHoverActive:{type:Boolean,default:!0}},computed:{isHideLogo:function(){return n.xB.isHideLogo}},methods:{onMoveOverDelete:function(){this.$emit("moveover:delete")}}}},637741:function(t,e,i){var n=i(798509),o=i(984928);e.Z={name:"HistoryClearItem",props:{wrapper:{type:String,default:"div"},rightBtnTitle:{type:String,default:n.Zr.L("清空")},isExpand:{type:Boolean,default:!1},showExpand:{type:Boolean,default:!1},selectInfo:{type:Object,default:function(){return{}}}},computed:{leftBtnTitle:function(){return this.isExpand?n.Zr.L("收起"):n.Zr.L("展开更多")},isExpandBtnActive:function(){return this.selectInfo.type===o.x9.FoldBtn},isClearBtnActive:function(){return this.selectInfo.type===o.x9.ClearBtn}},methods:{onMoveOverExpand:function(){this.$emit("hover",0,o.x9.FoldBtn)},onMoveOverClear:function(){this.$emit("hover",0,o.x9.ClearBtn)}}}},115351:function(t,e,i){var n=i(720144),o=i(275994),r=i(959018),s=i(798509),a=i(783466),c=i(984928),l=i(462474),u=i(448188),h=i(588624),d=i(931888),p=i(619269),f=i(349854),v=i(770952),y=i(20533),m=i(245017),x=i(437840),_=i(813463),g=i(420629),I=i(72628),w=i(827798),E=i(327075),S=i(84762),R=i(234031),B=i(111267);function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function C(t,e,i,n,o,r,s){try{var a=t[r](s),c=a.value}catch(t){i(t);return}a.done?e(c):Promise.resolve(c).then(n,o)}function A(t){return function(){var e=this,i=arguments;return new Promise(function(n,o){var r=t.apply(e,i);function s(t){C(r,n,o,s,a,"next",t)}function a(t){C(r,n,o,s,a,"throw",t)}s(void 0)})}}function L(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(t){return Object.getOwnPropertyDescriptor(i,t).enumerable}))),n.forEach(function(e){var n,o,r;n=t,o=e,r=i[e],o in n?Object.defineProperty(n,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[o]=r})}return t}function O(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):(function(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);i.push.apply(i,n)}return i})(Object(e)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))}),t}function H(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i,n,o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var r=[],s=!0,a=!1;try{for(o=o.call(t);!(s=(i=o.next()).done)&&(r.push(i.value),!e||r.length!==e);s=!0);}catch(t){a=!0,n=t}finally{try{!s&&null!=o.return&&o.return()}finally{if(a)throw n}}return r}}(t,e)||T(t,e)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(t){return function(t){if(Array.isArray(t))return b(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||T(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(t,e){if(t){if("string"==typeof t)return b(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if("Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return b(t,e)}}function Z(t,e){var i,n,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(o=2&r[0]?n.return:r[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,r[1])).done)return o;switch(n=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,n=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],n=0}finally{i=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}n.default.mixin(s.uW),e.Z={components:{HistoryItem:v.Z,HistoryClearItem:y.Z,PcHistoryBottomItem:m.Z,scroll:h.Z,exposureBlock:f.Z},mixins:[s.uW,p.Z,R.Z,B.Z],props:{selectInfo:{type:Object,default:function(){return{}}},listHeight:{type:Number,default:0},enableHoverActive:{type:Boolean,default:!0},isVert:{type:Boolean,default:!1}},data:function(){return{activatedCount:0,SearchInputId:d.P,historyList:[],showDelete:!1,reportEmpty:!1,isKeybordShow:!0,hasArrow:!1,isHistoryExpand:!1,windowHeight:0,indexStore:{}}},computed:O(L({selectIndex:function(){return c.x9.isInTargetArea(this.selectInfo.type)?this.selectInfo.pos:-1},historyListShow:function(){return this.isHistoryExpand?this.historyList.slice(0,20):this.historyList.slice(0,6)}},(0,g.rn)({uploadFileList:function(t){return t.chatbot.uploadFileList},pageId:function(t){return t.history.pageId}})),{showPcBottom:function(){return this.historyList.length>0},showPcBottomExpand:function(){return this.historyList.length>6},historyListStyle:function(){if(!this.isHistoryExpand)return null;var t,e,i,n,o,r,s,a,c,l,u,h,d,p,f,v,y,m=(null===(t=window.getComputedStyle(null===(i=this.$refs.historyItem)||void 0===i?void 0:null===(e=i[0])||void 0===e?void 0:e.$el))||void 0===t?void 0:t.marginTop)||0;(null==m?void 0:null===(n=m.endsWith)||void 0===n?void 0:n.call(m,"px"))?m=Number(m.slice(0,-2)):(console.warn("historyListStyle: itemPadding is not end with px, use default 6 instead"),m=6);var x=this.windowHeight-40,_=((null===(a=this.$refs.exposureBlock)||void 0===a?void 0:null===(s=a.$el)||void 0===s?void 0:null===(r=s.getBoundingClientRect)||void 0===r?void 0:null===(o=r.call(s))||void 0===o?void 0:o.top)||0)-m,g=x-_-((null===(h=this.$refs.bottomRef)||void 0===h?void 0:null===(u=h.$el)||void 0===u?void 0:null===(l=u.getBoundingClientRect)||void 0===l?void 0:null===(c=l.call(u))||void 0===c?void 0:c.height)||0),I=this.historyListShow.length,w=(null===(y=this.$refs.historyItem)||void 0===y?void 0:null===(v=y[0])||void 0===v?void 0:null===(f=v.$el)||void 0===f?void 0:null===(p=f.getBoundingClientRect)||void 0===p?void 0:null===(d=p.call(f))||void 0===d?void 0:d.height)||0;if(w*I+m*(I+1)<=g)return null;var E=(g-m)/(w+m),S=Math.floor(E)+.5;return S>=E&&(S=Math.floor(E-1)+.5),{height:"".concat(w*S+m*(S+1),"px"),overflowY:"overlay",overscrollBehavior:"none"}}}),activated:function(){this.activatedCount&&(this.KEYBOARD_HISTORY_REQUESTID="",this.getData()),this.activatedCount++},watch:{historyListStyle:{handler:function(t,e){var i=this;if(!!t&&!e)this.$nextTick(function(){i.$refs.historyScroll&&(i.$refs.historyScroll.scrollTop=0)})}},selectInfo:{handler:function(t){var e,i,n,o;if(!!c.x9.isInTargetArea(t.type))null===(n=this.$refs.historyItem)||void 0===n||null===(i=n[t.pos])||void 0===i||null===(e=(o=i.$el).scrollIntoViewIfNeeded)||void 0===e||e.call(o)}},historyList:{handler:function(){var t=this;this.$nextTick(function(){t.analysisExpose()})}}},created:function(){var t,e=this,i=this;a.N.onHisReady(function(t){if(a.h.delHis({isDeleteAll:1}),t.data&&t.data.length&&t.data[0].items.length){var i=t.data[0].items.map(function(t){return{hotword:t.word,id:s.Zr.generateGuuId().substring(0,13)}});e.historyList=i,s.su.set({key:e.localStorageKey(),value:i})}});var n=this;a.N.onSearchHistoryChanged((t=A(function(t){var e,i,o,r;return Z(this,function(a){switch(a.label){case 0:if(console.log("onSearchHistoryChanged",e="string"==typeof t?function(){try{return JSON.parse(t)}catch(t){return null}}():t),!e)return[2,console.error("onSearchHistoryChanged: res is empty")];if(i={key:n.localStorageKey()},!e.hasClear)return[3,1];return r=[],[3,3];case 1:return[4,s.su.get(i)];case 2:r=a.sent(),a.label=3;case 3:return o=r,n.historyList=_.Z.mergeHistory(i,e,o),e.hasClear&&s.su.set({key:n.localStorageKey(),value:[]}),[2]}})}),function(e){return t.apply(this,arguments)})),i.getData();if(l.Z.$on(l.U.HIS_MODIFIED,function(){i.getData()}),this.refreshWindowHeight(),window.addEventListener("resize",this.refreshWindowHeight),s.xB.scene===c.RL.KEYBOARD_HISTORY){var o="";try{o=s.xB.parentSearchID?s.xB.parentSearchID.split(":").pop():""}catch(t){console.error("history page get requestid err: ",t)}this.KEYBOARD_HISTORY_REQUESTID=o}else this.KEYBOARD_HISTORY_REQUESTID="";a.N.onCommonCgiReady(function(t){}),s.xB.scene===c.RL.GLOBAL_WEBSITE&&(w.Z.configNavBar({recommendSearchQuery:s.Zr.L("搜索网页")}),s.xB.setValue({forbidPlaceholderSearch:!0})),s.xB.scene==c.RL.FINDER_PROFILE_SEARCH&&s.xB.thirdExtParamNickName&&(w.Z.configNavBar({recommendSearchQuery:"搜索 ".concat(s.xB.thirdExtParamNickName," 发布的视频")}),s.xB.setValue({forbidPlaceholderSearch:!0}))},beforeDestroy:function(){window.removeEventListener("resize",this.refreshWindowHeight)},methods:{getIconUrl:function(t){var e,i=(null===(e=t.extLocalInfo)||void 0===e?void 0:e.historyUploadExtInfo)||{},n=i.uploadFileType;return!1===i.isActivePost?"":S.j4[n]},localStorageKey:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return s.xB.scene===c.ZP.scene.W1W_HOME?"history16777248":[c.ZP.scene.BIZ_SPECIFIC,c.ZP.scene.MP_INNER_TOP_RIGHT_SEARCH,c.ZP.scene.FROM_THIRD_PART_H5].includes(s.xB.scene)&&s.xB.userName?"history2|".concat(s.xB.userName):s.xB.scene===c.ZP.PcScenes.BIZ_UNION_TOP?s.xB.userName?"history2|".concat(s.xB.userName):"history2":[c.RL.FINDER_PROFILE_SEARCH].includes(s.xB.scene)?"history_".concat(s.xB.type,"_").concat(s.xB.thirdExtParamFinderUniqueId):[c.RL.MMSEARCH_SCENE_REC_FINDER_INNER_SEARCH,c.RL.MMSEARCH_SCENE_REC_PERMANENT_FINDER_INNER_SEARCH].includes(s.xB.scene)?"history_1011_17":s.xB.scene===c.RL.MP_TOP_RIGHT_SEARCH_ENTER||s.xB.scene===c.RL.AI_SUMMARY_ARTICLE||s.xB.scene===c.RL.EXTLINK_TOP_RIGHT_SEARCH_ENTER?"history_mp_ai_search":"history".concat(t)},handleTouchmove:function(){[c.RL.S1S,c.RL.GLOBAL_HISTORY,c.RL.GLOBAL,c.RL.KEYBORD_PRELOAD].includes(s.xB.scene);this.Container_CheckIsQuarkStyleV2()&&l.Z.$emit(l.U.H5_SEARCH_BAR_BLUR_INPUT)},report:function(t){t=["","",s.xB.platform,"","",parseInt(+new Date/1e3),"",""].concat(t),a.h.commonCgi({cgiName:u.yh.mmDataReport,data:{clientversion:s.xB.wechatVersion,device:s.xB.deviceType,item_list:[{logid:14884,log_buffer:t.join(",")}]}})},getData:function(t){return A(function(){var e,i,n,o,r,l,u,h,d,p,f,v,y;return Z(this,function(m){switch(m.label){case 0:return this.$store.commit("history/genPageId"),n=this.localStorageKey(t),[4,Promise.all([x.Z.get({key:n})||[],0==s.xB.type?s.su.get({abskey:"FTSBizClickFlow"}):function(){}])];case 1:if(l=void 0===(r=(o=H.apply(void 0,[m.sent(),2]))[0])?[]:r,h=void 0===(u=o[1])?{}:u,console.warn("getData",n,l),d=20,0===s.xB.type&&(d=c.vx.includes(s.xB.scene)?s.xB.historyMaxShowCount:s.xB.historyMaxShowCount+20),p={},f=(null==l?void 0:null===(e=l.filter(function(t){return c.vx.includes(t.scene)}))||void 0===e?void 0:e.slice(0,s.xB.historyMaxShowCount))||[],v=c.vx.includes(s.xB.scene)?[]:(null==l?void 0:null===(i=l.filter(function(t){var e;return!(null===(e=D(c.vx).concat(D(c.ZN)))||void 0===e?void 0:e.includes(t.scene))}))||void 0===i?void 0:i.slice(0,20))||[],this.historyList=D(f).concat(D(v)).sort(function(t,e){return(t.timestamp=t.timestamp||0,e.timestamp=e.timestamp||0,t.timestamp<e.timestamp)?1:t.timestamp>e.timestamp?-1:0}).reduce(function(t,e){return!p[e.hotword]&&(p[e.hotword]=!0,t.push(e)),t},[]).slice(0,d),this.historyList=x.Z.mergeLocalAccountHis({originHis:this.historyList,localAccountMap:h,maxCount:d}),this.showDelete=this.historyList.length,this.historyList.length)a.h.delHis({isDeleteAll:1});else{if(!s.xB.isSupportPermanentData&&a.h.getHis({scene:s.xB.scene}),this.reportEmpty)return[2];this.reportEmpty=!0,y=[4,"",s.xB.scene,0,"",this.historyList.length,"","",s.xB.sessionId,this.KEYBOARD_HISTORY_REQUESTID,this.pageId],this.report(y)}return[2]}})}).apply(this)},getXExp:function(){var t=this;(0,I.Ek)("mmsearch_mmsearchcommappsvr_history_input_switch",{useCache:!0,expireTime:7200}).then(function(e){var i=e.value,n=e.data;t.hasArrow=!!(null==n?void 0:n.ret)&&1==i})},onTapExpand:function(t){this.isHistoryExpand=t,this.M_clickReportFor26897("",0,{actionId:t?c.At.CLICK_UNFOLD:c.At.CLICK_FOLD},this.getBlockCtx())},toggleExpand:function(){this.onTapExpand(!this.isHistoryExpand)},tapDeleteAll:function(){return A(function(){var t;return Z(this,function(e){switch(e.label){case 0:return this.historyList=[],this.showDelete=!1,[4,x.Z.clear({key:this.localStorageKey()})];case 1:return e.sent(),a.h.delHis({isDeleteAll:1}),t=[2,"",s.xB.scene,0,"",this.historyList.length,"","",s.xB.sessionId,this.KEYBOARD_HISTORY_REQUESTID,this.pageId],this.report(t),this.M_clickReportFor26897("",0,{actionId:c.At.CLICK_CLEAR},this.getBlockCtx()),[2]}})}).apply(this)},tapDelete:function(t,e){return A(function(){var i,n;return Z(this,function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),i=this.historyList.splice(e,1)[0],!this.historyList.length&&(this.showDelete=!1),[4,x.Z.delete(i,{key:this.localStorageKey()})];case 1:return l.sent(),a.h.delHis({isDeleteAll:0,query:t.word}),n=["1",encodeURIComponent(s.yG.filterReportQuery(i.hotword)),s.xB.scene,(t.showType||0)+1,i.id,this.historyList.length,encodeURIComponent(i.hotword),e,s.xB.sessionId,this.KEYBOARD_HISTORY_REQUESTID,this.pageId],this.report(n),this.M_clickReportFor26897(this.getReportItem(t),this.getRealIndex(t,e)+1,{actionId:c.At.CLICK_DELETE},this.getBlockCtx()),(0,r.m6)(o.Z.detail.history.hisDel),[3,3];case 2:return console.error("删除历史失败",l.sent()),[3,3];case 3:return[2]}})}).apply(this)},tapItem:function(t,e){return A(function(){var i,n,u,h,d,p,f,v,y,m;return Z(this,function(_){switch(_.label){case 0:if(i=s.xB.query,s.xB.quarkStyleV2&&!this.M_checkCanSearch(this.uploadFileList))return[2];return this.$store.commit({type:"result/updateSearchInputValue",value:t.hotword}),this.$store.commit({type:"result/updateSearchKeyboardShow",value:!1}),a.h.setInputBar({query:t.hotword,isInputChange:!1}),s.xB.setValue({query:t.hotword}),[4,x.Z.getLocalAccountExtparams(t)];case 1:return n=_.sent(),t.showType?a.h.openView(O(L({},s.xB.getBase()),{searchId:"",actionType:8,jumpUrl:t.jumpUrl,query:t.hotword})):s.xB.scene==c.RL.HOME_TOP_ENTRY&&t.source&&Object.keys(t.source||{}).length?this.M_go(t.source):(h=(t.extReqParams||[]).slice(0),t.mixerCommonContext&&h.push({key:"mixerCommonContext",textValue:t.mixerCommonContext}),(null==n?void 0:n.crossExtReqParams)&&(d=h).push.apply(d,D(null!==(p=null==n?void 0:n.crossExtReqParams)&&void 0!==p?p:[])),f=function(){try{var e,i;return JSON.parse(decodeURIComponent(null===(i=t.extLocalInfo)||void 0===i?void 0:null===(e=i.historyUploadExtInfo)||void 0===e?void 0:e.parentSearchIDKV))}catch(t){return{}}}(),Object.assign(v={uiStyle:2,isDeepThink:(null===(u=s.xB.additionalCheckboxesExtReqParams.find(function(t){return"globalSearchDeepThink"===t}))||void 0===u?void 0:u.uintValue)||0,inputPos:2},f),h.push({key:"parentSearchID",textValue:this.M_composeParentSid({t:c.X$.SEARCH_HISTORY,s:this.pageId||"",did:t.hotword,kv:v})}),t.localAccInfo?s.xB.setValue({localAccExtParams:[{key:"localAccInfo",textValue:t.localAccInfo}]}):(null==n?void 0:n.localAccExtParams)&&s.xB.setValue({localAccExtParams:n.localAccExtParams}),y=t.extLocalInfo,l.Z.$emit(l.U.GOTO,L({page:c.kO.RESULT,query:t.hotword,action:c.Ss.HISTORY,searchId:"",extReqParams:h},y?{extLocalInfo:y}:{}))),m=["3",encodeURIComponent(s.yG.filterReportQuery(t.hotword)),s.xB.scene,(t.showType||0)+1,t.id,this.historyList.length,encodeURIComponent(t.hotword),e,s.xB.sessionId,this.KEYBOARD_HISTORY_REQUESTID,this.pageId],this.report(m),this.M_clickReportFor26897(this.getReportItem(t),this.getRealIndex(t,e)+1,this.getSearchClickExtInfo(t,i),{pageName:c.kO.HISTORY}),(0,r.m6)(o.Z.detail.history.his),[2]}})}).apply(this)},tapArrow:function(t,e){a.h.setInputBar({query:t.hotword,isInputChange:!1}),l.Z.$emit(u.U3.onInputChange,{query:t.hotword,isInputChange:!1});var i=[5,encodeURIComponent(s.yG.filterReportQuery(t.hotword)),s.xB.scene,(t.showType||0)+1,t.id,this.historyList.length,encodeURIComponent(t.hotword),e,s.xB.sessionId,this.KEYBOARD_HISTORY_REQUESTID,this.pageId];this.report(i)},expose:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(t.length){var e=[],i=[],n=[];t.forEach(function(t){var o=H(t.split("$$"),3),r=o[0],s=o[1],a=o[2];n.push(r),e.push(s),i.push(encodeURIComponent(a))});var o=[4,"",s.xB.scene,0,e.join("|"),this.historyList.length,i.join("|"),n.join("|"),s.xB.sessionId,this.KEYBOARD_HISTORY_REQUESTID,this.pageId];this.report(o)}},resetStatus:function(){return A(function(){var t;return Z(this,function(e){switch(e.label){case 0:if(this.isHistoryExpand=!1,!E.Z.isSupportPCOpSearchHistory)return[3,2];return[4,this.getData()];case 1:e.sent(),e.label=2;case 2:return null===(t=this.$refs.exposureBlock)||void 0===t||t.resetExposeId(),this.resetIndexStore(),[2]}})}).apply(this)},refreshWindowHeight:function(){this.windowHeight=window.innerHeight},analysisExpose:function(){var t;null===(t=this.$refs.exposureBlock)||void 0===t||t.analysisExpose()},onScroll:function(){this.analysisExpose()},getBlockCtx:function(){return{pageName:c.kO.HISTORY}},getReportItem:function(t){return O(L({},t),{docId:encodeURIComponent(t.hotword),reason:"".concat(t.scene,"_").concat(t.businesstype)})},emitHover:function(t,e){this.$emit("hover",t,e)},isDeleteActive:function(t){return this.selectInfo.type===c.x9.TargetDelete&&this.selectInfo.pos===t},overDelete:function(t){this.$emit("hover",t,c.x9.TargetDelete)},exposeReportFor26897:function(t){this.M_exposeReportFor26897(t,this.getBlockCtx())},getSearchClickExtInfo:function(t,e){var i={query:e};return t.showType?i.actionId=c.At.H5:i.actionId=this.isVert?c.At.VERTICAL:c.At.ALL_SEARCH,i},resetIndexStore:function(){var t=this;this.indexStore={},this.historyList.forEach(function(e,i){t.indexStore[e.hotword]=i})},getRealIndex:function(t,e){var i=this.indexStore[t.hotword];return void 0!==i?i:e}}}}}]);