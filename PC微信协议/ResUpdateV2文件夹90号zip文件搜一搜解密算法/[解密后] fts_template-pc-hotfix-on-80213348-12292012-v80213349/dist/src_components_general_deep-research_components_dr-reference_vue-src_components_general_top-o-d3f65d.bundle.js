"use strict";(self.webpackChunkweixin_search=self.webpackChunkweixin_search||[]).push([["src_components_general_deep-research_components_dr-reference_vue-src_components_general_top-o-d3f65d"],{35406:function(t,e,n){var o=n(92366),r=n(653048),i=n(551900),a=n(942579),c=(0,i.Z)(r.Z,o.s,o.x,!1,null,"7736627f",null);"function"==typeof a.Z&&(0,a.Z)(c),e.Z=c.exports},492015:function(t,e,n){n.d(e,{Z:function(){return o}});function o(t){t.options.__wxs_id="2c9fa338"}},192451:function(t,e,n){var o=n(453651),r=n(615134),i=n(551900),a=n(319292),c=(0,i.Z)(r.Z,o.s,o.x,!1,null,"111bb400",null);"function"==typeof a.Z&&(0,a.Z)(c),e.Z=c.exports},924307:function(t,e,n){n.d(e,{Z:function(){return o}});function o(t){t.options.__wxs_id="b2a69172"}},574184:function(t,e,n){var o=n(356618),r=n(849094),i=n(551900),a=n(525434),c=(0,i.Z)(r.Z,o.s,o.x,!1,null,"f8b023d0",null);"function"==typeof a.Z&&(0,a.Z)(c),e.Z=c.exports},873703:function(t,e,n){n.d(e,{Z:function(){return o}});function o(t){t.options.__wxs_id="e4eae71e"}},24587:function(t,e,n){var o=n(514149),r=n(124010),i=n(551900),a=n(49114),c=(0,i.Z)(r.Z,o.s,o.x,!1,null,"8b242a4c",null);"function"==typeof a.Z&&(0,a.Z)(c),e.Z=c.exports},852589:function(t,e,n){n.d(e,{Z:function(){return o}});function o(t){t.options.__wxs_id="dd1052e1"}},851061:function(t,e,n){var o=n(438487),r=n(152032),i=n(551900),a=n(104477),c=(0,i.Z)(r.Z,o.s,o.x,!1,null,"04976368",null);"function"==typeof a.Z&&(0,a.Z)(c),e.Z=c.exports},211745:function(t,e,n){n.d(e,{Z:function(){return o}});function o(t){t.options.__wxs_id="ea1ca76c"}},942579:function(t,e,n){var o=n(492015);e.Z=o.Z},319292:function(t,e,n){var o=n(924307);e.Z=o.Z},525434:function(t,e,n){var o=n(873703);e.Z=o.Z},49114:function(t,e,n){var o=n(852589);e.Z=o.Z},104477:function(t,e,n){var o=n(211745);e.Z=o.Z},653048:function(t,e,n){var o=n(50502);e.Z=o.Z},615134:function(t,e,n){var o=n(390831);e.Z=o.Z},849094:function(t,e,n){var o=n(607418);e.Z=o.Z},124010:function(t,e,n){var o=n(866357);e.Z=o.Z},152032:function(t,e,n){var o=n(776242);e.Z=o.Z},92366:function(t,e,n){n.d(e,{s:function(){return o},x:function(){return r}});var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"active",rawName:"v-active.stop",modifiers:{stop:!0}}],staticClass:"dr-reference-item active__mask",attrs:{"dr-doc-report-id":t.forbidReport?"":t.DRR_docExposeReportId({docId:t.getDocId(t.urlInfo),docType:t.docType,docPos:t.pos}),"data-cli":"","data-fcn-dr-reference-item":"","data-fr-13f804ef6":""},on:{click:function(e){return e.stopPropagation(),t.onTap(e)}}},[n("ui-clamp",{attrs:{autoresize:"","max-lines":2,"data-fc-19eece00a":""},scopedSlots:t._u([{key:"before",fn:function(){return[t.urlInfo.number?n("span",{staticClass:"dr-reference-item__number"},[t._v(t._s(t.urlInfo.number))]):t._e()]},proxy:!0},{key:"after",fn:function(){return[n("text-auto-newline",{attrs:{"data-fc-19eece008":""}},[n("ui-arrow",{attrs:{gap:"",direction:"right","data-fc-19eece006":""}})],1)]},proxy:!0}])},[[n("span",{staticClass:"dr-reference-item__title"},[t._v(t._s(t.title))])]],2)],1)},r=[]},453651:function(t,e,n){n.d(e,{s:function(){return o},x:function(){return r}});var o=function(){var t=this.$createElement,e=this._self._c||t;return this.refUrls.length?e("div",{staticClass:"dr-reference",attrs:{"data-fcn-dr-reference":"","data-fr-1a96aef8c":""}},[this.hideTitle?this._e():e("div",{staticClass:"dr-reference__title"},[this._v("参考资料")]),e("div",{staticClass:"dr-reference__list"},this._l(this.listToShow,function(t,n){return e("dr-reference-item",{key:t.docId||t.title,attrs:{"url-info":t,pos:n+1,"data-fc-183f30192":""}})}),1),this.canShowFoldBtn?e("div",{directives:[{name:"active",rawName:"v-active.instant.stop",modifiers:{instant:!0,stop:!0}}],staticClass:"dr-reference__fold-btn active__mask",attrs:{"dr-doc-report-id":this.DRR_docExposeReportId({docId:"more_reference",docType:"more_reference"}),"data-cli":""},on:{click:this.onTapUnFold}},[e("div",[this._v("展开全部资料")]),e("ui-arrow",{attrs:{gap:"",align:"flex",direction:"down","data-fc-183f30190":""}})],1):this._e()]):this._e()},r=[]},356618:function(t,e,n){n.d(e,{s:function(){return o},x:function(){return r}});var o=function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"top-qa-model-red-dot",attrs:{"data-fcn-model-red-dot":"","data-fr-17d7e7aed":""}})},r=[]},514149:function(t,e,n){n.d(e,{s:function(){return o},x:function(){return r}});var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.isRealShow?n("div",{ref:"menuRef",staticClass:"selection-menu",style:t.menuStyle,attrs:{"data-fcn-selection-menu":"","data-fr-1525d082a":""}},[n("div",{staticClass:"selection-menu__arrow",style:t.arrowStyle}),t._l(t.items,function(e,o){return n("div",{directives:[{name:"active",rawName:"v-active.stop",modifiers:{stop:!0}}],key:e.key,staticClass:"selection-menu__item active__absolute",attrs:{"data-report-id":e.needExposeReport?t.M_itemReportId(e.reportId,o+1):void 0,"data-cli":""},on:{click:function(n){return n.stopPropagation(),t.onClick(e)}}},[n("ui-image",{staticClass:"selection-menu__item-icon",attrs:{url:e.icon,size:16,"data-fc-1035e01a6":""}}),n("div",{staticClass:"selection-menu__item-text"},[t._v(t._s(e.text))])],1)})],2):t._e()},r=[]},438487:function(t,e,n){n.d(e,{s:function(){return o},x:function(){return r}});var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"underline-selection",attrs:{"data-fcn-underline-selection":"","data-fr-1ae439f20":""},on:{"!click":function(e){return t.onClickContainer(e)},"!touchstart":function(e){return t.onShow(e)}}},[t._t("default"),n("selection-menu",{ref:"selectionMenuRef",attrs:{"is-show":t.isSelectionMenuShown,items:t.menuItems,"position-data":t.selectionPosition,"data-fc-172e7ddc1":""},on:{"click:menu-item":t.onClickSelectionMenuItem}})],2)},r=[]},50502:function(t,e,n){var o=n(798509),r=n(984928),i=n(152750),a=n(657857);e.Z={name:"DrReferenceItem",components:{TextAutoNewline:a.Z},mixins:[o.uW,o.jB,i.kP],inject:{halfScreenContext:{default:function(){return null}}},props:{urlInfo:{type:Object,default:function(){return{}}},pos:{type:Number,default:1},forbidReport:{type:Boolean,default:!1}},computed:{docType:function(){return this.halfScreenContext?"pop_screen":"reference"},title:function(){var t,e=null===(t=this.urlInfo.title)||void 0===t?void 0:t.replace(/（/g,"(").replace(/）/g,")");return this.urlInfo.nickName?"".concat(this.urlInfo.nickName,": ").concat(e):e}},methods:{getDocId:function(t){var e,n;return"".concat(null!==(e=t.docId)&&void 0!==e?e:"","_").concat(null!==(n=t.sourceType)&&void 0!==n?n:"")},onTap:function(){if(this.M_serviceSearchGo({jumpInfo:{jumpType:r.sn.H5,jumpUrl:this.urlInfo.url}}),!this.forbidReport)this.DRR_clickReport({actionType:r.At.H5,docInfo:this.DRR_generateDocReportId({docId:this.getDocId(this.urlInfo),docType:this.docType,docPos:this.pos})})}}}},390831:function(t,e,n){var o=n(798509),r=n(35406),i=n(152750),a=n(984928);e.Z={name:"DrReference",components:{DrReferenceItem:r.Z},mixins:[o.uW,o.jB,i.kP],props:{refUrls:{type:Array,default:function(){return[]}},foldCount:{type:Number,default:0},hideTitle:{type:Boolean,default:!1}},data:function(){return{hasUnfold:!1}},computed:{listToShow:function(){return this.hasUnfold||!this.foldCount?this.refUrls:this.refUrls.slice(0,this.foldCount)},canShowFoldBtn:function(){return this.foldCount&&this.refUrls.length>this.foldCount&&!this.hasUnfold}},methods:{onTapUnFold:function(){this.hasUnfold=!0,this.DRR_clickReport({actionType:a.At.CLICK_UNFOLD,docInfo:this.DRR_generateDocReportId({docId:"more_reference",docType:"more_reference"})})}}}},607418:function(t,e){e.Z={}},866357:function(t,e,n){var o=n(798509),r=n(234031);function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}function a(t,e,n,o,r,i,a){try{var c=t[i](a),s=c.value}catch(t){n(t);return}c.done?e(s):Promise.resolve(s).then(o,r)}var c=function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n,o,r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var i=[],a=!0,c=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);a=!0);}catch(t){c=!0,o=t}finally{try{!a&&null!=r.return&&r.return()}finally{if(c)throw o}}return i}}(e,2)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}}(e,n)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],a=o[1];if(r<=a)return[r,a];var c=(r+a)/2;return[c,c]},s=function(t,e){return Math.max(e[0],Math.min(t,e[1]))};e.Z={name:"SelectionMenu",mixins:[o.Sx,o.uW,o.jB,r.Z],inject:{getCustomNavBarHeight:{default:function(){return 0}},topQARootElement:{default:function(){return function(){return null}}}},props:{isShow:{type:Boolean,default:!1},positionData:{type:Object,default:function(){return null}},items:{type:Array,default:function(){return[]}}},data:function(){return{isRealShow:!1,placement:"top",topPosition:null,bottomPosition:null}},computed:{currentPosition:function(){return("top"===this.placement?this.topPosition:this.bottomPosition)||null},menuStyle:function(){return this.currentPosition?{top:"".concat(this.currentPosition.top,"px"),left:"".concat(this.currentPosition.left,"px")}:{}},arrowStyle:function(){return this.currentPosition?{left:"".concat(this.currentPosition.arrowLeft,"px"),top:"top"===this.placement?"100%":"0"}:{display:"none"}},canShow:function(){return this.isShow&&!!this.positionData&&!!this.items.length}},watch:{canShow:{handler:function(t){t?this.initMenu():this.resetMenu()},immediate:!0}},methods:{resetMenu:function(){this.isRealShow=!1,this.placement="top",this.topPosition=null,this.bottomPosition=null},initMenu:function(){var t;return(t=function(){var t,e,n,r,i,a,l,u,f,h,d,p,v,m,S;return function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,function(g){switch(g.label){case 0:if(t=this,!this.positionData)return[2];return this.isRealShow=!0,[4,this.$nextTick()];case 1:return g.sent(),i=(r=this.$refs.menuRef.getBoundingClientRect()).width,a=r.height,u=(l=this.positionData).top,f=l.bottom,d=c([0,(h=l.boundary).width-i]),(p={left:s((u.left+u.right)/2-i/2,d),top:u.y-a-16}).arrowLeft=(u.left+u.right)/2-p.left,(v={left:s((f.left+f.right)/2-i/2,d),top:f.y+16}).arrowLeft=(f.left+f.right)/2-v.left,this.topPosition=p,this.bottomPosition=v,(null===(e=(n=this).topQARootElement)||void 0===e?void 0:e.call(n))&&!o.xB.chatbot?(m=this.topQARootElement().getBoundingClientRect().top,this.placement=u.y+h.top-m>=a+16?"top":"bottom"):(S=function(){if(o.xB.chatbot){var e,n;return(null===(e=(n=t).getCustomNavBarHeight)||void 0===e?void 0:e.call(n))||0}return o.xB.quarkStyle||o.xB.quarkStyleV2?t.Container_GetHeaderHeight()+(o.xB.quarkStyleV2?o.Zr.unitHeightRef().value:0):o.Zr.unitHeightRef().value||0}(),this.placement=u.y+h.top-S>=a+48?"top":"bottom"),[4,this.$nextTick()];case 2:return g.sent(),this.updatePlacement(),[2]}})},function(){var e=this,n=arguments;return new Promise(function(o,r){var i=t.apply(e,n);function c(t){a(i,o,r,c,s,"next",t)}function s(t){a(i,o,r,c,s,"throw",t)}c(void 0)})}).apply(this)},updatePlacement:function(){},onClick:function(t){var e=this.M_clickReport({},t);this.$emit("click:menu-item",t,e)}}}},776242:function(t,e,n){var o=n(798509),r=n(984928),i=n(728223),a=n(24587),c=n(691409),s=n(836378),l=n(84762),u=n(10151);function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}function h(t,e,n,o,r,i,a){try{var c=t[i](a),s=c.value}catch(t){n(t);return}c.done?e(s):Promise.resolve(s).then(o,r)}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),o.forEach(function(e){var o,r,i;o=t,r=e,i=n[e],r in o?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i})}return t}function p(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):(function(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);n.push.apply(n,o)}return n})(Object(e)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}),t}function v(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(t,e)}}(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var m={COPY:"https://search.wxqcloud.qq.com/t/components/icons/base/copy_filled.svg",FORWARD:"https://search.wxqcloud.qq.com/t/components/icons/base/share_filled.svg",UNDERLINE:"https://search.wxqcloud.qq.com/t/fed_upload/70463474c07edd31aacdfb483f3d21ad/edit.svg",FAVORITES:"https://res.wx.qq.com/t/components/icons/base/favorites_filled.svg",SEARCH:"https://res.wx.qq.com/t/components/icons/base/search_filled.svg"};e.Z={components:{SelectionMenu:a.Z},mixins:[o.Sx,o.uW,o.jB,u.Z],provide:function(){return{selectionDataList:this.selectionDataList,onClickSelectionData:this.onClickSelectionData,topQAUnderlineGetContentContextBySelectSpan:this.getContentContextBySelectSpan}},inject:{topQASearchIdForServer:{default:""},topQASearchIdForReport:{default:""},mixedBoxChatbotCtx:{default:function(){return null}}},props:{canShare:{type:Boolean,default:!0},isSupportAiForward:{type:Boolean,default:!1}},data:function(){return{nodeToRootMap:new WeakMap,selectionPosition:null,isSelectionMenuShown:!1,removeSelectionMenu:null,selectionDataList:[],activeSelectionData:null,activeRange:null,isInActiveSelectionGap:!1,ActiveSelectionGapTimer:null,disableForwardButCanCopy:!1,dispose:null,menuShowTimes:0}},computed:{enable:function(){return o.FP.isSupportCustomPerformAction&&(o.xB.chatbot||this.source.enableFingerSearch&&o.FP.isSupportTopQAFingerSearch&&!this.mixedBoxChatbotCtx)},nowSelectionData:function(){return this.activeSelectionData||(0,s.OL)(this.activeRange)},menuItems:function(){var t=this.nowSelectionData,e=function(e){return t?"".concat(t.startTag,"_").concat(t.startSeq,"_").concat(t.startOffset,"_").concat(t.endTag,"_").concat(t.endSeq,"_").concat(t.endOffset,":").concat(e):"no_pos:".concat(e)},n=this.menuShowTimes<=1,o=[{key:"copy",icon:m.COPY,text:"复制",reportId:e("pop_copy"),actionType:r.At.CLICK_COPY,needExposeReport:n}];return!this.disableForwardButCanCopy&&this.canShare&&this.isSupportAiForward&&(o.push.apply(o,[{key:"forward",icon:m.FORWARD,text:"转发",reportId:e("pop_share"),actionType:r.At.CLICK_SHARE,needExposeReport:n}]),o.push.apply(o,v(v([])))),o.push({key:"search",icon:m.SEARCH,text:"搜一搜",reportId:e("pop_search"),needExposeReport:n,actionType:r.At.ALL_SEARCH}),o}},watch:{enable:{handler:function(t){var e,n=this;null===(e=this.dispose)||void 0===e||e.call(this),t&&(document.addEventListener("selectionchange",this.onSelectionChange),document.addEventListener("resize",this.onResize),document.addEventListener("contextmenu",this.onContextMenu),document.addEventListener("pointerup",this.onPointerUp),document.addEventListener("touchend",this.onPointerUp),o.Gc.$on(o.U3.CONSOLE_SHOW,this.onConsoleShow),o.Gc.$on(o.U3.CONSOLE_HIDE,this.onConsoleHide),this.dispose=function(){document.removeEventListener("selectionchange",n.onSelectionChange),document.removeEventListener("resize",n.onResize),document.removeEventListener("contextmenu",n.onContextMenu),document.removeEventListener("pointerup",n.onPointerUp),document.removeEventListener("touchend",n.onPointerUp),o.Gc.$off(o.U3.CONSOLE_SHOW,n.onConsoleShow),o.Gc.$off(o.U3.CONSOLE_HIDE,n.onConsoleHide)})},immediate:!0}},mounted:function(){var t,e=this;this.enable&&(this.preloadIconUrls(),this.onShow(),o.hi.preloadWebSearchPage());var n=o.Zr.safeJsonParse(null===(t=this.source.shareUnderScore)||void 0===t?void 0:t.json);n&&(this.selectionDataList.push(p(d({},n),{isPrivate:this.source.shareUnderScore.isMe})),setTimeout(function(){var t=Array.from(e.$el.querySelectorAll('[seq="'.concat(n.startSeq,'"][').concat(n.startTag,"]"))).find(function(t){return t.getBoundingClientRect().left<window.innerWidth});if(t){var o=t.getBoundingClientRect().top,r=window.scrollY+o-window.innerHeight/2;r>0&&(0,c.G$)(r)}},0))},beforeUnmount:function(){var t;null===(t=this.removeSelectionMenu)||void 0===t||t.call(this)},beforeDestroy:function(){var t;null===(t=this.dispose)||void 0===t||t.call(this),this.onHide()},methods:{onConsoleShow:function(){this.onHide()},onConsoleHide:function(){this.$store.commit({type:"chatbot/updateIsPerformActionEnabled",autoDisabled:!0})},onShow:function(){if(!!this.enable)this.$store.commit({type:"chatbot/updateIsPerformActionEnabled",enabled:0}),this.$store.commit({type:"chatbot/updateNeedResumePerformAction",value:!0})},onHide:function(){if(!!this.enable&&!o.xB.chatbot)this.$store.commit({type:"chatbot/updateNeedResumePerformAction",value:!0}),this.$store.commit({type:"chatbot/updateIsPerformActionEnabled",enabled:1})},preloadIconUrls:function(){var t=Object.values(m);o.Zr.preloadImages(t,!0)},onClickContainer:function(t){var e,n,o;if(null===(n=this.$refs.selectionMenuRef)||void 0===n?!void 0:null===(e=n.$el)||void 0===e?!void 0:!e.contains(t.target))null===(o=this.removeSelectionMenu)||void 0===o||o.call(this)},onSelectionChange:function(){var t;null===(t=this.removeSelectionMenu)||void 0===t||t.call(this)},onResize:function(){var t;null===(t=this.removeSelectionMenu)||void 0===t||t.call(this)},onContextMenu:function(t){this.$el&&t.target&&this.$el.contains(t.target)&&t.preventDefault()},onPointerUp:function(){var t=this;this.checkSelectionMenuShow(),setTimeout(function(){t.checkSelectionMenuShow()},300)},checkSelectionMenuShow:function(){if(this.isSelectionMenuShown)return;var t,e=this.getRange();if(!!e){this.activeRange=e;var n=(0,s.OL)(e);this.disableForwardButCanCopy=!this.checkCanForward(e,n),console.error("getSharePostData",this.getSharePostData(n)),this.showSelectionMenu(null==e?void 0:null===(t=e.getClientRects)||void 0===t?void 0:t.call(e))}},checkCanForward:function(t,e){if(!e)return!1;var n=t.commonAncestorContainer;if(!this.$el.contains(n))return!1;var o="underline-selection--disabled",r=function(t){return t.nodeType===Node.ELEMENT_NODE&&(t.classList.contains(o)||t.querySelector(".".concat(o)))},i=this.$el.querySelector(".top-one-qa__content");if(i.contains(n)){var a=(0,s.H6)(i),c=a.filter(function(t){var n=(0,s.Pb)(t),o=n.seq,r=n.textTag;return!!(o==e.startSeq&&r===e.startTag||o==e.endSeq&&r===e.endTag||(0,s.R2)({seq:o,textTag:r},e))||!1});return console.error("selectSeqSpanList",{seqSpanList:a,selectSeqSpanList:c}),!c.some(function(t){return r(t)})}for(;n;){if(r(n))return!1;if(n=n.parentElement,!this.$el.contains(n))return!1}return!0},getAllNormalText:function(){var t=document.createRange(),e=this.$el.querySelectorAll(".selectable-text");return t.setStart(e[0],0),t.setEndAfter(e[e.length-1]),t.toString()},getContentContextBySelectSpan:function(t,e){var n=(0,s.Pb)(t).textTag,o=(0,s.Pb)(e).textTag,r=n===o?n:"",i=Array.from(this.$el.querySelectorAll(".selectable-text")).filter(function(t){return!r||(0,s.Pb)(t).textTag===r}),a=document.createRange();a.setStart(i[0],0),a.setEndAfter(i[i.length-1]);var c=a.toString(),l=i.findIndex(function(e){return e===t}),u=i.findIndex(function(t){return t===e});if(-1===l||-1===u)return c;for(var f=0,h=0,d=0;d<l;d++)f+=i[d].textContent.length;for(var p=0;p<=u;p++)h+=i[p].textContent.length;var v=Math.floor((f+h)/2),m=Math.max(0,v-256),S=Math.min(c.length,v+256);return S-m<512&&c.length>512&&(0===m?S=Math.min(c.length,512):S===c.length&&(m=Math.max(0,c.length-512))),c.substring(m,S)||c},getSharePostData:function(t){if(!t)return null;var e=document.createRange(),n=this.$el.querySelectorAll(".selectable-text");e.setStart(n[0],0),e.setEndAfter(n[n.length-1]);var o=e.toString(),r=t.text,i=document.createRange();i.setStart(n[0],0);var a=Array.from(n).find(function(e){var n=(0,s.Pb)(e),o=n.seq,r=n.textTag;return o===t.startSeq&&r===t.startTag});return i.setEndBefore(a),{totalText:o,selectedText:r,offset:i.toString().length+t.startOffset}},getFingerSearchQueryContext:function(t,e){var n=Array.from(this.$el.querySelectorAll(".selectable-text"));if(t){var r=t.startSeq,i=t.startTag,a=t.endSeq,c=t.endTag,l=n.find(function(t){var e=(0,s.Pb)(t),n=e.seq,o=e.textTag;return n===r&&o===i}),u=n.find(function(t){var e=(0,s.Pb)(t),n=e.seq,o=e.textTag;return n===a&&o===c});if(l&&u)return this.getContentContextBySelectSpan(l,u);o.hi.log({key:"ai-search-underline",msg:"getFingerSearchQueryContext, query: ".concat(e,"。 ").concat(l?"":"startSpan not found"," ").concat(u?"":"endSpan not found")})}else o.hi.log({key:"ai-search-underline",msg:"getFingerSearchQueryContext, query: ".concat(e,"。 no selectionData")});var f=function(t){if(0===t.length)return"";var e=document.createRange();return e.setStart(t[0],0),e.setEndAfter(t[t.length-1]),e.toString()},h=function(t,e){var n=t.indexOf(e);if(-1===n)return t;var o=Math.max(0,n-256),r=Math.min(t.length,n+256);return t.substring(o,r)},d=f(n.filter(function(t){return"answer"===(0,s.Pb)(t).textTag}));if(d.includes(e))return h(d,e);var p=f(n.filter(function(t){return"think"===(0,s.Pb)(t).textTag}));if(p.includes(e))return h(p,e);var v=f(n);return v.includes(e)?h(v,e):d},showSelectionMenu:function(t){var e,n=this,o=this.getRangePosition(t);if(!!o)null===(e=this.removeSelectionMenu)||void 0===e||e.call(this),this.selectionPosition=o,this.isSelectionMenuShown=!0,this.menuShowTimes+=1,this.removeSelectionMenu=function(){n.activeRange=null,n.activeSelectionData=null,n.selectionPosition=null,n.isSelectionMenuShown=!1,n.removeSelectionMenu=null,n.selectionDataList.forEach(function(t,e){t.active&&n.$set(n.selectionDataList,e,p(d({},t),{active:!1}))})}},getRange:function(){var t=document.getSelection();if(!t||t.rangeCount<=0)return null;var e=t.getRangeAt(0);return e&&!e.collapsed&&(0,s.r3)(this.$el,e.commonAncestorContainer)?(console.error("range",e),e):null},getRangePosition:function(t){var e=this.getRootRect();if(!e||!(null==t?void 0:t.length))return null;var n=null,o=null,r=function(t,e){var n=Math.min(t.left,e.left),o=Math.min(t.top,e.top),r=Math.max(t.right,e.right),i=Math.max(t.bottom,e.bottom);return DOMRect.fromRect({x:n,y:o,width:r-n,height:i-o})};return(t.forEach(function(t){if(!(t.width*t.height<10))n?n.top-t.top>10?n=t:n.top-t.top>-10&&(n=r(t,n)):n=t,o?t.bottom-o.bottom>10?o=t:t.bottom-o.bottom>-10&&(o=r(t,o)):o=t}),n&&o)?{top:{y:n.top-e.top,left:n.left-e.left,right:n.right-e.left},bottom:{y:o.bottom-e.top,left:o.left-e.left,right:o.right-e.left},boundary:{width:e.width,top:e.top}}:null},getRootRect:function(){var t,e;return(null===(e=this.$el)||void 0===e?void 0:null===(t=e.getBoundingClientRect)||void 0===t?void 0:t.call(e))||null},onClickSelectionMenuItem:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(e=function(){var e,i,a,c,s,u,f,h;return function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,function(d){switch(d.label){case 0:switch(this.isSelectionMenuShown=!1,t.key){case"copy":return[3,1];case"forward":return[3,2];case"underline":return[3,3];case"favorites":return[3,4];case"search":return[3,5]}return[3,9];case 1:return this.handleCopy(),[3,9];case 2:return(a=this.getSharePostData(this.nowSelectionData))&&this.$emit("forward",{posterData:a,selectionData:this.nowSelectionData,clickReportOption:n}),[3,9];case 3:return this.activeSelectionData?this.handleRemoveUnderline(this.activeSelectionData):this.handleUnderline(),[3,9];case 4:return(c=this.nowSelectionData)&&this.$emit("favorites",{selectionData:c}),[3,9];case 5:if(!(f=(null===(s=this.activeSelectionData)||void 0===s?void 0:s.text)||(null===(u=this.activeRange)||void 0===u?void 0:u.toString())))return[2];if(!(o.FP.isSupportTopQAFingerSearch&&this.source.enableFingerSearch))return[3,7];return[4,o.Zr.handleToggleFullScreen()];case 6:return d.sent(),h=this.getFingerSearchQueryContext(this.nowSelectionData,f),this.M_serviceSearchGo({jumpType:r.sn.ALL_SEARCH,isHalfScreen:!0,needPreGet:!0,query:f,scene:r.RL.MMSEARCH_SCENE_AIANSWER_FINGER_SEARCH,extParams:{hideSearchBar:!0,parentSearchID:this.M_composeParentSid({isFromOpenSearchWebview:!0,t:r.X$.MMSEARCH_TYPE_MP_FINGER_SEARCH,s:this.topQASearchIdForReport||o.xB.searchId,kv:{scene:o.xB.scene,clickId:n.clickId}}),crossExtReqParams:[{key:"aiSearchUploadInfo",textValue:JSON.stringify({contentType:l.Tv.Answer,uploadFiles:[{fileType:l.Tv.Answer,fileContentDetail:{aiAnswerDetail:{search_id:this.topQASearchIdForServer||o.xB.searchId}}}]})},{key:"mpFingerSearchQueryContext",textValue:h}]},customNavBarParams:{hideSearchBar:!0,nativeConfig:{title:f}}}),[3,8];case 7:this.M_serviceSearchGo({jumpInfo:{jumpType:r.sn.ALL_SEARCH,scene:r.RL.MMSEARCH_SCENE_FROM_AI_SEARCH_FINGER_JUMP,parentSearchID:this.M_composeParentSid({t:r.X$.FINGER,s:this.data.vueSearchId||o.xB.searchId,rid:this.data.vueRid}),query:f}}),d.label=8;case 8:return[3,9];case 9:return null===(e=(i=this).removeSelectionMenu)||void 0===e||e.call(i),document.getSelection().removeAllRanges(),[2]}})},function(){var t=this,n=arguments;return new Promise(function(o,r){var i=e.apply(t,n);function a(t){h(i,o,r,a,c,"next",t)}function c(t){h(i,o,r,a,c,"throw",t)}a(void 0)})}).apply(this)},handleCopy:function(){var t,e,n=(null===(t=this.activeSelectionData)||void 0===t?void 0:t.text)||(null===(e=this.activeRange)||void 0===e?void 0:e.toString());n&&o.Zr.copyText(n,!0).then(function(){o.Gc.$emit(o.U3.showToast,{action:i.g.pure,text:"内容已复制"})})},handleUnderline:function(){var t=(0,s.OL)(this.activeRange);console.error("handleUnderline",t,this.activeRange);var e=(0,s.Se)(t);if(e!==t.text&&console.error("handleUnderline not match: ",e,t.text),!!t)return this.selectionDataList.push(t),t},handleRemoveUnderline:function(t){if(!!t){var e=this.selectionDataList.findIndex(function(e){return(0,s.ni)(e,t)});~e&&this.selectionDataList.splice(e,1)}},onClickSelectionData:function(t,e){var n=this,r=this.$el.querySelector('[seq="'.concat(t.startSeq,'"][').concat(t.startTag,"]")),i=this.$el.querySelector('[seq="'.concat(t.endSeq,'"][').concat(t.endTag,"]"));if(!r||!i){o.hi.log({key:"ai-search-underline",msg:"selectionData not found, startSpan: ".concat(!!r,", endSpan: ").concat(!!i,", selectionData: ").concat(JSON.stringify(t))});return}var a=v(Array.from(r.querySelectorAll(".underline-selection")).map(function(t){return t.getBoundingClientRect()})).concat(v(Array.from(i.querySelectorAll(".underline-selection")).map(function(t){return t.getBoundingClientRect()})));this.activeSelectionData=t,this.showSelectionMenu(a);var c=this.selectionDataList.findIndex(function(e){return(0,s.ni)(e,t)});~c&&this.$set(this.selectionDataList,c,p(d({},this.selectionDataList[c]),{active:!0})),this.isInActiveSelectionGap=!0,this.ActiveSelectionGapTimer&&clearTimeout(this.ActiveSelectionGapTimer),this.ActiveSelectionGapTimer=setTimeout(function(){n.ActiveSelectionGapTimer=null,n.isInActiveSelectionGap=!1},300)}}}},10151:function(t,e,n){n(462474),n(836378),n(129997),e.Z={}}}]);